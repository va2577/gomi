<!DOCTYPE html>
<html data-bs-theme="dark">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BTC-USD</title>
    <link rel="icon" href="img/16290097.png" type="image/png">
    <link rel="apple-touch-icon" href="img/16290097.png" type="image/png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <!--
        BTC-USD
        https://finance.yahoo.com/quote/BTC-USD/history/ ~2025-01-31
        https://coinmarketcap.com/currencies/bitcoin/ 2025-02-01~
    -->
    <style>
        #tap-zone {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 80px;
            height: 80px;
            z-index: 9999;
            background-color: rgba(0, 0, 0, 0);
        }
    </style>
</head>

<body>
    <div id="tap-zone"></div>
    <div class="modal fade" id="modal1" tabindex="-1" aria-labelledby="modal1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col">
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control text-end fs-2 font-monospace" id="input1" placeholder="100000" value="100000">
                                    <label for="input1">資金</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control text-end fs-2 font-monospace" id="input2" placeholder="15000000" value="15000000">
                                    <label for="input2">価格</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="number" class="form-control text-end fs-2 font-monospace text-info-emphasis" id="input3" placeholder="0.006666666" value="0.006666666" readonly>
                                    <label for="input3">数量</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <canvas id="myChart1"></canvas>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.6/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.5.0/build/global/luxon.min.js" integrity="sha256-/TZdvWBQbZdgT95AgMF6nDLyjhe3QdOMpw4VLnkcgq4=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js" integrity="sha256-qk+I9RaF57Ium9VLcn0ZYWjuhbjOXOCCwBl+xnaXa1s=" crossorigin="anonymous"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const CHART_COLORS = {
                red: "rgb(255, 99, 132)",
                orange: "rgb(255, 159, 64)",
                yellow: "rgb(255, 205, 86)",
                green: "rgb(75, 192, 192)",
                blue: "rgb(54, 162, 235)",
                purple: "rgb(153, 102, 255)",
                grey: "rgb(201, 203, 207)",
            }
            const array1 = await fetchData("BTC-USD.csv")
            newChart("myChart1", array1, CHART_COLORS.red)

            async function fetchData(input) {
                const r = await fetch(input)
                const t = await r.text()
                const a1 = t.split("\n")
                const a2 = a1.map(x => x.split(","))
                const a3 = a2.slice(1, -1)
                const a4 = a3.map(x => ({
                    date: new Date(Date.parse(x[0])),
                    price: parseFloat(x[4]),
                }))
                a4.sort((a, b) => {
                    if (a.date < b.date) return -1
                    if (b.date < a.date) return 1
                    return 0
                })
                return a4
            }

            function newChart(elementId, array, color) {
                const element = document.getElementById(elementId)
                const config = {
                    type: "line",
                    data: {
                        labels: array.map(x => x.date),
                        datasets: [{
                            label: "BTC-USD",
                            data: array.map(x => x.price),
                            // borderColor: color,
                            fill: false,
                            tension: 0.4,
                        }],
                    },
                    options: {
                        plugins: {
                            legend: {
                                display: false,
                            },
                        },
                        scales: {
                            x: {
                                type: "time",
                                time: {
                                    displayFormats: {
                                        week: "LLL yyyy",
                                        month: "LLL yyyy",
                                        quarter: "LLL yyyy",
                                        year: "yyyy",
                                    },
                                    tooltipFormat: "yyyy LLL dd",
                                },
                            },
                        },
                    },
                }
                const chart = new Chart(element, config)
            }
        })
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll("input").forEach(x => x.addEventListener("input", listener))
            listener()
            function listener() {
                calculate()
            }
            function calculate() {
                const length = 8
                const value1 = document.getElementById("input1").valueAsNumber
                const value2 = document.getElementById("input2").valueAsNumber
                if (isNaN(value1)) return
                if (isNaN(value2)) return
                if (value2 === 0) return
                document.getElementById("input3").value = truncateDecimal(value1 / value2, length).toFixed(length)
            }
            function truncateDecimal(value, digits) {
                const factor = Math.pow(10, digits)
                return Math.floor(value * factor) / factor
            }
        })
        document.addEventListener("DOMContentLoaded", () => {
            const tapZone = document.getElementById("tap-zone")
            let tapCount = 0
            let lastTapTime = 0
            tapZone.addEventListener("pointerup", () => {
                const now = Date.now()
                if (now - lastTapTime < 500) {
                    tapCount += 1
                } else {
                    tapCount = 1
                }
                lastTapTime = now
                if (tapCount === 2) {
                    const myModal = bootstrap.Modal.getOrCreateInstance("#modal1")
                    myModal.show()
                    tapCount = 0
                }
            })
        })
    </script>
</body>

</html>
